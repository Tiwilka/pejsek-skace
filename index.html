<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animal Runner</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; font-family: 'Arial'; background: #cceeff; }
    canvas { display: block; margin: 0 auto; background: #87ceeb; touch-action: manipulation; }
    #menu { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); background: #fff; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
    .animal-btn { margin: 10px; cursor: pointer; font-size: 24px; padding: 10px 20px; border: none; border-radius: 10px; background-color: #eee; }
    #score, #highscore { position: absolute; top: 10px; font-size: 20px; background: rgba(255,255,255,0.8); padding: 8px 12px; border-radius: 10px; }
    #score { left: 10px; }
    #highscore { left: 150px; }
    #music-toggle { position: absolute; top: 10px; right: 10px; font-size: 16px; background: #fff; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="menu">
    <h2>Vyber si zv√≠≈ô√°tko:</h2>
    <button class="animal-btn" onclick="startGame('racek')">üïäÔ∏è Racek</button>
    <button class="animal-btn" onclick="startGame('cat')">üê± Koƒçka</button>
    <button class="animal-btn" onclick="startGame('panda')">üêº Panda</button>
  </div>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="score">Score: 0</div>
  <div id="highscore">Highscore: 0</div>
  <button id="music-toggle" onclick="toggleMusic()">üîà Music</button>

  <audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>
  <audio id="collectSound">
    <source src="collect.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const highscoreDisplay = document.getElementById('highscore');
    const bgMusic = document.getElementById('bgMusic');
    const collectSound = document.getElementById('collectSound');

    let gameSpeed = 4;
    let maxSpeed = 9;
    let score = 0;
    let highscore = localStorage.getItem('highscore') || 0;
    let gravity = 1.0;
    let jumpPower = -15;
    let isJumping = false;
    let animal = 'racek';
    let playerY = 300;
    let velocityY = 0;
    let obstacles = [];
    let foods = [];
    let gameRunning = false;
    let images = {};

    const groundY = 340;
    const foodTypes = [
      { name: 'croissant', points: 1 },
      { name: 'babovka', points: 1 },
      { name: 'chlebicek', points: 1 },
      { name: 'bonbon', points: 2 }
    ];

    function preloadImages() {
      images['racek'] = new Image();
      images['racek'].src = 'images/racek.png';
    }

    preloadImages();

    function startGame(selectedAnimal) {
      document.getElementById('menu').style.display = 'none';
      animal = selectedAnimal;
      gameRunning = true;
      bgMusic.play();
      generateObstacle();
      generateFood();
      requestAnimationFrame(gameLoop);
    }

    function toggleMusic() {
      if (bgMusic.paused) {
        bgMusic.play();
      } else {
        bgMusic.pause();
      }
    }

    function drawPlayer() {
      if (animal === 'cat') {
        ctx.font = '40px Arial';
        ctx.fillText('üê±', 100, playerY + 40);
      } else if (animal === 'panda') {
        ctx.font = '40px Arial';
        ctx.fillText('üêº', 100, playerY + 40);
      } else {
        ctx.drawImage(images[animal], 100, playerY, 50, 50);
      }
    }

    function generateObstacle() {
      const interval = Math.random() * 2000 + 1800; // 1.8‚Äì3.8 sekundy
      setTimeout(() => {
        obstacles.push({ x: canvas.width, width: 40, height: 50 });
        if (gameRunning) generateObstacle();
      }, interval);
    }

    function generateFood() {
      const interval = Math.random() * 3000 + 1500;
      setTimeout(() => {
        const food = foodTypes[Math.floor(Math.random() * foodTypes.length)];
        foods.push({ x: canvas.width, y: groundY - 80, type: food.name, points: food.points });
        if (gameRunning) generateFood();
      }, interval);
    }

    function drawObstacles() {
      ctx.fillStyle = '#8B4513';
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, groundY - ob.height, ob.width, ob.height);
      });
    }

    function drawFoods() {
      foods.forEach(fd => {
        const img = new Image();
        img.src = `images/${fd.type}.png`;
        ctx.drawImage(img, fd.x, fd.y, 30, 30);
      });
    }

    function checkCollisions() {
      obstacles.forEach(ob => {
        if (100 < ob.x + ob.width && 100 + 30 > ob.x && playerY + 40 > groundY - ob.height) {
          endGame();
        }
      });

      foods = foods.filter(fd => {
        if (Math.abs(fd.x - 100) < 30 && Math.abs(fd.y - playerY) < 40) {
          score += fd.points;
          collectSound.play();
          gameSpeed = Math.min(gameSpeed + 0.1, maxSpeed);
          return false;
        }
        return true;
      });
    }

    function endGame() {
      gameRunning = false;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem('highscore', highscore);
      }
      alert('Game over! Your score: ' + score);
      window.location.reload();
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#228B22';
      ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

      drawPlayer();
      drawObstacles();
      drawFoods();
      checkCollisions();

      obstacles.forEach(ob => ob.x -= gameSpeed);
      foods.forEach(fd => fd.x -= gameSpeed);

      velocityY += gravity;
      playerY += velocityY;
      if (playerY > 300) {
        playerY = 300;
        velocityY = 0;
        isJumping = false;
      }

      scoreDisplay.innerText = 'Score: ' + score;
      highscoreDisplay.innerText = 'Highscore: ' + highscore;

      requestAnimationFrame(gameLoop);
    }

    function jump() {
      if (!isJumping && gameRunning) {
        velocityY = jumpPower;
        isJumping = true;
      }
    }

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space') jump();
    });

    window.addEventListener('touchstart', () => {
      jump();
    });
  </script>
</body>
</html>
