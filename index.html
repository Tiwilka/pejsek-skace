<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animal Runner</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; font-family: 'Arial'; background: #cceeff; }
    canvas { display: block; margin: 0 auto; background: #87ceeb; }
    #menu { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); background: #fff; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
    .animal-btn { margin: 10px; cursor: pointer; font-size: 24px; padding: 10px 20px; border: none; border-radius: 10px; background-color: #eee; }
    #score, #highscore { position: absolute; top: 10px; font-size: 20px; background: rgba(255,255,255,0.8); padding: 8px 12px; border-radius: 10px; }
    #score { left: 10px; }
    #highscore { left: 150px; }
    #music-toggle { position: absolute; top: 10px; right: 10px; font-size: 16px; background: #fff; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="menu">
    <h2>Choose your animal:</h2>
    <button class="animal-btn" onclick="startGame('cat')">üê± Cat</button>
    <button class="animal-btn" onclick="startGame('panda')">üêº Panda</button>
    <button class="animal-btn" onclick="startGame('rabbit')">üê∞ Rabbit</button>
  </div>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="score">Score: 0</div>
  <div id="highscore">Highscore: 0</div>
  <button id="music-toggle" onclick="toggleMusic()">üîà Music</button>

  <audio id="bgMusic" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>
  <audio id="collectSound">
    <source src="collect.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const highscoreDisplay = document.getElementById('highscore');
    const bgMusic = document.getElementById('bgMusic');
    const collectSound = document.getElementById('collectSound');

    let gameSpeed = 4;
    let maxSpeed = 9;
    let score = 0;
    let highscore = localStorage.getItem('highscore') || 0;
    let gravity = 0.9; // ni≈æ≈°√≠ gravitace = del≈°√≠ skok
    let jumpPower = -20; // vƒõt≈°√≠ s√≠la skoku
    let isJumping = false;
    let animal = 'rabbit';
    let playerY = 300;
    let velocityY = 0;
    let obstacles = [];
    let apples = [];
    let gameRunning = false;
    let images = {};

    const groundY = 340;

    function preloadImages() {
      ['cat', 'panda', 'rabbit'].forEach(animal => {
        const img = new Image();
        img.src = animal + '.png';
        images[animal] = img;
      });
    }

    preloadImages();

    function startGame(selectedAnimal) {
      document.getElementById('menu').style.display = 'none';
      animal = selectedAnimal;
      gameRunning = true;
      bgMusic.play();
      generateObstacle();
      generateApple();
      requestAnimationFrame(gameLoop);
    }

    function toggleMusic() {
      if (bgMusic.paused) {
        bgMusic.play();
      } else {
        bgMusic.pause();
      }
    }

    function drawPlayer() {
      ctx.drawImage(images[animal], 100, playerY, 50, 50);
    }

    function generateObstacle() {
      setTimeout(() => {
        obstacles.push({ x: canvas.width, width: 40, height: 50 });
        if (gameRunning) generateObstacle();
      }, 2000);
    }

    function generateApple() {
      setTimeout(() => {
        apples.push({ x: canvas.width, y: groundY - 80 });
        if (gameRunning) generateApple();
      }, 2500);
    }

    function drawObstacles() {
      ctx.fillStyle = '#8B4513';
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, groundY - ob.height, ob.width, ob.height);
      });
    }

    function drawApples() {
      ctx.font = '30px Arial';
      apples.forEach(ap => {
        ctx.fillText('üçé', ap.x, ap.y);
      });
    }

    function checkCollisions() {
      obstacles.forEach(ob => {
        if (100 < ob.x + ob.width && 100 + 30 > ob.x && playerY + 40 > groundY - ob.height) {
          endGame();
        }
      });

      apples = apples.filter(ap => {
        if (Math.abs(ap.x - 100) < 30 && Math.abs(ap.y - playerY) < 40) {
          score++;
          collectSound.play();
          gameSpeed = Math.min(gameSpeed + 0.2, maxSpeed);
          return false;
        }
        return true;
      });
    }

    function endGame() {
      gameRunning = false;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem('highscore', highscore);
      }
      alert('Game over! Your score: ' + score);
      window.location.reload();
    }

    function gameLoop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#228B22';
      ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

      drawPlayer();
      drawObstacles();
      drawApples();
      checkCollisions();

      obstacles.forEach(ob => ob.x -= gameSpeed);
      apples.forEach(ap => ap.x -= gameSpeed);

      velocityY += gravity;
      playerY += velocityY;
      if (playerY > 300) {
        playerY = 300;
        velocityY = 0;
        isJumping = false;
      }

      scoreDisplay.innerText = 'Score: ' + score;
      highscoreDisplay.innerText = 'Highscore: ' + highscore;

      requestAnimationFrame(gameLoop);
    }

    window.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && !isJumping && gameRunning) {
        velocityY = jumpPower;
        isJumping = true;
      }
    });
  </script>
</body>
</html>
